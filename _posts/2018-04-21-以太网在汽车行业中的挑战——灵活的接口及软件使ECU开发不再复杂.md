
---
layout: post
title: "灵活的接口及软件使ECU开发不再复杂"
date: 2018-04-21 22:39:06
tags: 汽车 以太网
key: 20180417223906
description: 以太网将会在一批新车型中作为一个车载系统网络使用。因此，下一步就是以太网和现有汽车网络技术的集成，包括：CAN、FlexRay、LIN和MOST网络。目前，存在许多开发工具，可以帮助开发者完成不同类型网络之间的数据分析。但就车载以太网来说，市面上只有分析普通办公以太网的标准工具，这些工具却不能满足特殊物理层和IP协议层的车载以太网的技术要求
---

# 以太网在汽车行业中的挑战——灵活的接口及软件使ECU开发不再复杂

> 以太网将会在一批新车型中作为一个车载系统网络使用。因此，下一步就是以太网和现有汽车网络技术的集成，包括：CAN、FlexRay、LIN和MOST网络。目前，存在许多开发工具，可以帮助开发者完成不同类型网络之间的数据分析。但就车载以太网来说，市面上只有分析普通办公以太网的标准工具，这些工具却不能满足特殊物理层和IP协议层的车载以太网的技术要求。因此，迫切需要一些开发和测试工具，来分析和测试现有车载网络系统及车载以太网系统。但是，这些研发工具的特殊具体技术要求是什么？

[转载-原文链接 https://blog.csdn.net/weilely123/article/details/51113862](https://blog.csdn.net/weilely123/article/details/51113862) 

![image](http://upload-images.jianshu.io/upload_images/4938916-0a802b0450972d45.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 前言
目前在汽车上，最先进的车载以太网技术是使用低廉的非屏蔽双绞线， 100MBits/s速率传输影音数据。这一技术称为BroadR-Reach技术，并被OPEN Alliance SIG联盟[1]标准化。该联盟的下一目标是推广以太网作为车载网络，到2015年应用到汽车的娱乐和辅助驾驶系统。部分OEM厂商预测，最早2018年以太网将成为关键汽车技术[2]。正如一些专业文章[3,4]报到的，以太网凭借其灵活性、可扩展性、廉价性在汽车应用中推广，并定义了适用汽车应用的以太网协议(图1,[1])。更为重要的是，以太网将IT技术引入到丰富成熟的汽车工业中。
## 车载以太网测试解决方案的挑战
- 以太网在汽车上的应用，需要开发人员和测试工程师在技术上全新规划。首先，必须获取一个清晰的网络架构（图2）。在此网络架构中，主网络已经不再是一个总线系统，而是使用全双工连接的交互式网络。应用该网络实现网络实时，同步技术需要在物理层（OSI第一层）以上的高层协议上实现，例如AVB网络协议（Audio Video Bridging，图1）。对于新的网络架构，分析能力的需求也在增长，比如开放者希望通过主网络同时分析所有的传输数据，那么就要求主网络可以同步所有分支网络数据（图2中A、B、C、D分支）。

![图1](http://upload-images.jianshu.io/upload_images/4938916-fd82fdbdb7989413.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

  
借鉴通用办公以太网UDP、TCP/IP，定义了满足汽车应用的以太网协议，该协议已被ISO CD17215-1标准化

- 其次，开发人员必须找到新的、合理的数据处理方法来处理巨大的数据。过快的传输速率（千兆每秒）加大了快速数据处理的负担，开发商亟待解决这一问题。适合此需求的物理层——千兆以太网双绞线，已在开发中。
## 最小化接口对系统性能的影响
不同于普通总线系统，以太网测试必须采取特殊方式避免对整个系统的影响。一方面，开发者必须在系统设计早期考虑测试的可行性。另一方面，以太网测试工具必须最小化测试接口对系统的影响。下面是对分析和测试所列出的各种测量步骤；并对测试过程中的不良影响做了解释，及如何最小化这些不良影响。
## 以前解决方案的局限性
传统分析以太网的方法是在以太网系统的交换机上使用一个端口作为监测端口。所有交换机接收到的数据转发到这个监测端口上，这提供了接收的数据，但这些数据在时间上，没有一个共同的时间参考。除此之外，只有有效的数据转发到数据端口上，这使得错误分析变得困难。此外，成本原因，产品化的交换机上没有预留额外的监测端口。

![图2](http://upload-images.jianshu.io/upload_images/4938916-d9fba65f4dc9f64f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

未来的汽车上IP网络的网络结构。为了能够分析以太网所有的数据，分析软件必须能够同步访问所有以太网路径。

如果交换机上没有预留额外的端口可用，在现有网络连接中可以插入一个额外的交换机。该交换机的插入可使数据在传输过程中添加一个动态延时。满足ABV协议的网络是带有时间同步的，而该动态延时扰乱了AVB网络的时间同步。
       对于这个测量设置，可用使用IT领域里常用的工具和交换机。然而，对于在汽车领域里逐渐广泛应用的BroadRReach网络，需要执行一个影音以太网向标准以太网的（IEEE802.3）转化。此外，从汽车网络发展的角度看，这些传统的以太网测量工具是孤立的测试解决方案，因为他们没有把汽车上正在使用并尤为重要的总线系统测试考虑到内。
## 透明的以太网分析方法
对于以太网的监测，尽可能的选用一个透明的方法，代替额外的交换机作为接口监测网络。其主要目的是避免由于时间延时的增加及对故障报文的过滤而产生的对系统的影响。这一问题可以通过直接在以太网物理层获取或捕捉物理电平数据的TAP（Test Access Point）（图3）测试避免。（图4，Path1）。在该过程中，延迟时间不但短而且稳定，这样在分析AVB系统是非常有利的。另一透明的监测方法是通过使用支持AVB时间同步的交换机。该交换机支持AVB协议，可补偿由于报文传输的时间延时。
       无论选择哪种方法，目的是准确分析带有精确时间戳的报文数据。因此我们尽可能的获取靠近物理层的数据是最可靠的。这些时间戳必须是与其它接口同步的，因为对网络数据分析不只仅仅从以太网上获取数据（图2）。
       对于一个非激活状态的接口必须是透明的，例如，硬件接口装在车辆上，对车进行试驾，这个硬件接口即便应用程序不工作，也必须主动切换到单机模式下工作，否则行车过程中以太网通信将被打断。

## 带有仿真的TAP
在数据分析中，测试者需要通过有意的发送某些数据报文来测试网络的状态。纯监测两个节点之间的连接状态应该越少越好。然而，这些测试报文不会直接通过物理层发送，因为需要通过流控制大量报文的发送。因此只能通过数据链路层来发送这些报文。这就伴随这动态延时的产生，该延时可通过通信协议来消除，如AVB协议。
       测试报文有两种用途，其一是在正常通信的两个节点之间发送补充故障数据，来测试网络（图4，path3）。这些数据也可以通过测试软件发送，如CANoe.IP，要么通过一个报文发生器来发送，该发生器在接口处可直接产生一个定义的总线负载（图4，Path2）

![图3](http://upload-images.jianshu.io/upload_images/4938916-aa9c5f3dce83544d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

 网络分析或残余总线仿真的以太网接口的布线。必须实现和常规汽车总线系统的同步

## 剩余总线仿真
在开发某一单独ECU时，ECU集成到真实网络之前，对该网段上除该ECU之外的其余网络的仿真是测试各种潜在问题的灵活可行方法。首先，硬件测试是必须的，测试ECU能够满足接入任何高性能网络。其次，应用程序必须能够正向记录和向硬件发送数据（图4，path4）。第三，软件和硬件的结合必须接收打包数据，解压数据，并且发送解压数据。这就为ECU的测试提供了方法，测试包括ECU错误处理能力，如协议错误。

## 接口/软件灵活组合的重要性
以太网测试环境（软件/硬件）如何处理不同被测硬件和软件的需求。为避免测试环境为不同的测试设置更改接口，最好灵活作将一个TAP、转换器、或者带其它功能的交换机做接口使用。这类接口应该具备以下特性：
- 最简单情况，当接口使用TAP时，TAP本身只能产生最小的，允许范围内的延时时间。

![图4](http://upload-images.jianshu.io/upload_images/4938916-a28d5408c6652704.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

VN5610结合CANoe.IP/CANalyzer.IP，实现以太网数据的收发。通过灵活配置，支持不同配置需求的以太网分析和测试

- 接口必须能在不同类型影音之间进行数据转化，如BroadR-Reach, 快速以太网, 千兆以太网及未来的 RTPGE等等。这就省掉了传统方法中额外媒体转换器的使用。
- 对于试驾车辆，车上必须安装接口，且该接口不被使用时，不能干扰网络的通信（单机模式）。
- 多包数据发生器的软件及硬件质量非常重要，因为除了网络分析，汽车开发也需要可控的激励。
- 与仿真软件匹配的硬件接口必须允许真正的媒体访问一个甚至几个虚拟网络节点（剩余总线仿真）。
- 使用分析和仿真工具必须能够分析和操作OSI协议参考模型的所有数据。
- 接口必须支持异构网络，必须能够同步各类总线系统的；
从办公通信领域与外部媒体转换器组合使用的以太网分析工具的功能往往过于简单。车载网络工具的特定需求只能是专业的硬件配合专业的仿真分析软件。Vector公司的以太网/CAN接口工具VN5600与CANoe.IP软件是一个被无数实践验证的强大的车载以太网仿真、测试、开发软硬件组合工具。该解决方案已被部分整车厂和供应商所使用。

## 展望
未来五到十年，汽车上将会出现更多不同类型网络的集成。继以太网在车载影音领域的应用成熟之后，车载以太网将会应用在汽车上的更多领域，并会替换掉部分总线系统。以太网成为车载主网络之后，以太网与IP技术将会渗透到汽车的更多其它技术应用中。
多总线交互能力、残余总线仿真、数据传输的低延时将会是车载网络开发的重要因素。对于Vector，在以太网及IP领域工具开发的下一目标就是支持用户在IP协议的所有层（图1）实时查询所有信号，并实现面向服务的通信。例如：通过AVB协议或部分IP协议。
